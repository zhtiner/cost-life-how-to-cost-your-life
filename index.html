<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
  <title>花 生- how to cost your life H5</title>
  <!-- 字体：Inter & Noto Sans -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- 图标：Remixicon -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.7.0/fonts/remixicon.css" rel="stylesheet">
  <!-- 样式 -->
  <link rel="stylesheet" href="./style.css" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- 顶部预警横幅（消费趋势预警） -->
  <div id="warningBanner" class="warning-banner hidden">
    <i class="ri-alert-line"></i>
    <div class="wb-text">
      <b>消费预警：</b><span id="warningText">最近3天支出显著高于30天均值，注意控制！</span>
    </div>
    <button id="closeWarning" class="wb-close"><i class="ri-close-line"></i></button>
  </div>

  <!-- App 容器（375px 基准宽度） -->
  <div class="app">
    <!-- 顶部栏 -->
    <header class="app-header breathe-in">
      <div class="title-wrap">
        <h1>轻记账</h1>
        <span class="subtitle">柔和 · 呼吸感 · H5</span>
      </div>
      <div class="month-summary" id="monthSummary">
        <!-- 动态填充：本月总支出 / 最大开销分类 / 心情摘要 -->
      </div>
    </header>

    <!-- 预算进度（首页显著位置） -->
    <section id="budgetSection" class="section card fade-in">
      <div class="sec-head">
        <h2><i class="ri-pie-chart-2-line"></i> 分类预算</h2>
        <button id="editBudgetBtn" class="link-btn"><i class="ri-edit-2-line"></i>设置</button>
      </div>
      <div id="budgetBars" class="budget-bars">
        <!-- 动态渲染每个分类的预算进度条 -->
      </div>
    </section>

    <!-- 首页：消费记录流 + 筛选 -->
    <main id="homeView" class="view active">
      <section class="section card fade-in">
        <div class="sec-head">
          <h2><i class="ri-calendar-todo-line"></i> 消费记录</h2>
          <div class="filters">
            <select id="categoryFilter">
              <option value="all">全部分类</option>
              <option value="餐饮">餐饮</option>
              <option value="购物">购物</option>
              <option value="娱乐">娱乐</option>
              <option value="美妆">美妆</option>
              <option value="交通">交通</option>
              <option value="其他">其他</option>
            </select>
          </div>
        </div>
        <div id="recordList" class="record-list">
          <!-- 卡片列表 -->
        </div>
      </section>
    </main>

    <!-- 记录：快速记账 + 生活记录空间 -->
    <main id="recordView" class="view">
      <!-- 快速记账 -->
      <section class="section card fade-in">
        <h2 class="sec-title"><i class="ri-add-circle-line"></i> 快速记账</h2>
        <form id="addForm" class="add-form" autocomplete="off">
          <div class="form-row">
            <label>金额(¥)</label>
            <input type="number" step="0.01" min="0" id="amountInput" placeholder="如 36.50" required />
          </div>
          <div class="form-row two">
            <div>
              <label>分类</label>
              <select id="categoryInput" required>
                <option value="餐饮">餐饮</option>
                <option value="购物">购物</option>
                <option value="娱乐">娱乐</option>
                <option value="美妆">美妆</option>
                <option value="交通">交通</option>
                <option value="其他">其他</option>
              </select>
            </div>
            <div>
              <label>心情标签</label>
              <select id="moodInput">
                <option value="">无</option>
                <option value="开心">开心</option>
                <option value="治愈">治愈</option>
                <option value="解压">解压</option>
                <option value="审慎">审慎</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <label>备注</label>
            <input type="text" id="noteInput" maxlength="60" placeholder="写点什么（支持情绪关键词识别）" />
          </div>
          <div class="form-row">
            <label class="img-label">
              <i class="ri-image-add-line"></i> 上传图片
              <input type="file" id="imageInput" accept="image/*" hidden />
            </label>
            <div id="imagePreview" class="img-preview"></div>
          </div>
          <button class="btn-primary" type="submit"><i class="ri-save-3-line"></i> 保存</button>
        </form>
        <p class="help-note">图片将自动压缩为缩略图并保存在本地（localStorage）。</p>
      </section>

      <!-- 生活记录空间（动态流 / 相册） -->
      <section class="section card fade-in">
        <div class="sec-head tabs">
          <button id="tabFeed" class="tab-btn active">动态流</button>
          <button id="tabGallery" class="tab-btn">相册</button>
        </div>
        <div id="lifeFeed" class="life-feed">
          <!-- 按时间顺序的卡片流 -->
        </div>
        <div id="lifeGallery" class="life-gallery hidden">
          <!-- 瀑布拼贴图 -->
        </div>
      </section>
    </main>

    <!-- 统计：饼图 + 趋势图 + 心情分析 -->
    <main id="statsView" class="view">
      <section class="section card fade-in">
        <div class="sec-head">
          <h2><i class="ri-donut-chart-line"></i> 分类占比</h2>
          <div class="filters">
            <select id="timeRange">
              <option value="month">本月</option>
              <option value="week">本周</option>
              <option value="30d">近30天</option>
              <option value="all">全部</option>
            </select>
          </div>
        </div>
        <div class="chart-wrap">
          <canvas id="pieChart" height="200"></canvas>
        </div>
      </section>

      <section class="section card fade-in">
        <div class="sec-head">
          <h2><i class="ri-line-chart-line"></i> 支出趋势</h2>
          <div class="segmented">
            <button data-span="7" class="seg active">7天</button>
            <button data-span="30" class="seg">30天</button>
          </div>
        </div>
        <div class="chart-wrap">
          <canvas id="lineChart" height="220"></canvas>
        </div>
        <p class="chart-tip">趋势图将高亮预警区间，并给出建议。</p>
      </section>

      <section class="section card fade-in">
        <div class="sec-head">
          <h2><i class="ri-emotion-line"></i> 心情分析</h2>
        </div>
        <div id="moodStats" class="mood-stats">
          <!-- 本月“开心消费”占比、关键词等 -->
        </div>
      </section>
    </main>

    <!-- 设置：预算设置、数据管理 -->
    <main id="settingsView" class="view">
      <section class="section card fade-in">
        <h2 class="sec-title"><i class="ri-settings-3-line"></i> 预算设置</h2>
        <form id="budgetForm" class="budget-form">
          <!-- 动态渲染预算输入 -->
        </form>
        <div class="row-actions">
          <button id="saveBudgetBtn" class="btn-primary"><i class="ri-checkbox-circle-line"></i> 保存预算</button>
          <button id="resetDataBtn" class="btn-ghost"><i class="ri-delete-bin-6-line"></i> 清空数据</button>
        </div>
      </section>
      <section class="section card fade-in">
        <h2 class="sec-title"><i class="ri-information-line"></i> 关于</h2>
        <p class="about">
          - 所有数据仅存储于本地浏览器的 localStorage。<br/>
          - 心情分析采用规则词库，可在 <code>script.js</code> 替换为更高级的 AI 服务（如调用 OpenAI / 腾讯AI）。<br/>
          - 初次加载已附带 3 条示例消费记录（含图片）。<br/>
          - UI 适配手机端（375px 基准），尽量避免溢出与错位。
        </p>
      </section>
    </main>

    <!-- 底部导航 -->
    <nav class="tabbar">
      <button data-target="homeView" class="tab-item active"><i class="ri-home-5-line"></i><span>首页</span></button>
      <button data-target="recordView" class="tab-item"><i class="ri-file-add-line"></i><span>记录</span></button>
      <button data-target="statsView" class="tab-item"><i class="ri-bar-chart-2-line"></i><span>统计</span></button>
      <button data-target="settingsView" class="tab-item"><i class="ri-user-settings-line"></i><span>设置</span></button>
    </nav>
  </div>

  <!-- 图片详情弹窗（相册点击） -->
  <div id="imageModal" class="modal hidden">
    <div class="modal-mask"></div>
    <div class="modal-panel">
      <button id="closeModal" class="modal-close"><i class="ri-close-line"></i></button>
      <img id="modalImg" src="" alt="预览" />
      <div id="modalInfo" class="modal-info"></div>
    </div>
  </div>

  <!-- 脚本 -->
  <script src="./script.js"></script>
</body>
</html>
